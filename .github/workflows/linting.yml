name: üßπ Linting

on:
  push:
    branches: [ dev, main ]
  pull_request:
    branches: [ dev, main ]
  workflow_dispatch:   # manual trigger for feature branches

jobs:
  ruff:
    name: Ruff Linter
    runs-on: ubuntu-latest
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v5
      - name: üßπ Run Ruff
        uses: astral-sh/ruff-action@v3

  mypy:
    name: Mypy Type Check
    runs-on: ubuntu-latest
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v5
      - name: üîç Read Python version from environment.yml
        id: python_version
        run: |
          PYTHON_VERSION=$(grep '^- python=' ./requirements/environment.yml | cut -d'=' -f2 | xargs)
          echo "PYTHON_VERSION=$PYTHON_VERSION"
          echo "PYTHON_VERSION=$PYTHON_VERSION" >> $GITHUB_ENV
      - name: üîç Run Mypy
        uses: jashparekh/mypy-action@v3
        with:
          path: './src'
          mypy_flags: '--verbose'
          python_version: ${{ env.PYTHON_VERSION }}
          mypy_config_file: 'pyproject.toml'